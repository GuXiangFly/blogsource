---
title: 大数据
date: 2020-12-1 13:22:54
tags: [大数据]


---




# 深入浅出Google File System

#### 我们如何保存一个小文件（存储在单个硬盘上我归类为小文件）？

在硬盘上一个我们存储元数据，以及各个block的文件偏移量

- 1 block = 4096Byte

<img src="https://gitee.com/guxiangfly/blogimage/raw/master/img/image-20201214150454966.png" alt="image-20201214150454966" style="zoom: 50%;" />



#### 2.如何保存一个大文件

<img src="https://gitee.com/guxiangfly/blogimage/raw/master/img/image-20201214150711727.png" alt="image-20201214150711727" style="zoom:50%;" />



#### 3.如何保存一个超大文件

- 缺点就是每个

<img src="https://gitee.com/guxiangfly/blogimage/raw/master/img/image-20201214150812993.png" alt="image-20201214150812993" style="zoom:50%;" />

缺点： chunkServer的所有数据变更需要通知master，master的压力会变大

#### 4.如何减少 master的数据和流量



- 其实master节点不需要记录某个chunk 是在 哪个 chunkServer 的 哪个 diskoffset，只需要知道 某个chunk在哪个 chunkserver上，然后由chunkserver 负责记录某个chunk在哪个diskoffset上

  这样，就减少了master的数据，chunk进行修改也不需要通知master

![image-20201214151233643](https://gitee.com/guxiangfly/blogimage/raw/master/img/image-20201214151233643.png)



#### 5.如何发现数据损坏

比方说我想发现 chunk12的某个数据损坏 ，我们只需要在读取某个 block的时候，对它进行checksum的校验。

chunk12是64M， 里面每个block是 64KB

每个 block 我们都给一个32bit的  checksum，用于校验当前 block是否损坏

1T文件的校验大小为： 1T/64KB * 32bit  = 64MB 





<img src="https://gitee.com/guxiangfly/blogimage/raw/master/img/image-20201214154323560.png" alt="image-20201214154323560" style="zoom:50%;" />





#### 6.减少ChunkServer 挂掉带来的损失

每个chunkserver会存3份

<img src="https://gitee.com/guxiangfly/blogimage/raw/master/img/image-20201214154524672.png" alt="image-20201214154524672" style="zoom:50%;" />

#### 7.如何恢复损坏的chunk

master记录每个 chunk 在哪个chunkserver 上，假设 chunkserver4上的 chunk03坏了，可以找master，master发现 chunkserver3 和 chunkserver5 上有 chunk03，那么直接复制一份chunk03给 chunkserver4

<img src="https://gitee.com/guxiangfly/blogimage/raw/master/img/image-20201214154800096.png" alt="image-20201214154800096" style="zoom:50%;" />





#### 8. 如何应对热点

<img src="https://gitee.com/guxiangfly/blogimage/raw/master/img/image-20201214155219286.png" alt="image-20201214155219286" style="zoom:50%;" />

如果我们发现当前某个chunk03 的副本被访问非常频繁，那么我们可以复制这个chunk03 让他放到多个 chunkserver上，将流量平分。



#### 9.如何读文件



#### 10.如何写文件

<img src="https://gitee.com/guxiangfly/blogimage/raw/master/img/image-20201214155801016.png" alt="image-20201214155801016" style="zoom:50%;" />
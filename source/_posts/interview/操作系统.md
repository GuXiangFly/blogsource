---
title: 操作系统 
date: 2018-11-1 13:22:54
tags: [MongoDB,java]


---

操作系统
======


## 内存管理

![image-20200719231512738](http://guxiangflyimagebucket.oss-cn-beijing.aliyuncs.com/img/image-20200719231512738.png)

![image-20200719231739044](http://guxiangflyimagebucket.oss-cn-beijing.aliyuncs.com/img/image-20200719231739044.png)



###  1.内存空间的扩充

#### 覆盖技术

​	- ![image-20200719233055618](http://guxiangflyimagebucket.oss-cn-beijing.aliyuncs.com/img/image-20200719233055618.png)



![image-20200719233302954](http://guxiangflyimagebucket.oss-cn-beijing.aliyuncs.com/img/image-20200719233302954.png)





#### 交换技术

交换技术核心思想：

> 内存空间紧张时，系统将内存中某些进程暂时换出外存，把外村中某些已经具备运行条件的进程换入内存（进程在内存和磁盘间动态调度）

交换技术在内存空间紧张的时候，内存被换出的进程会进入挂起状态（挂起态，suspend）

挂起态可以分为 就绪挂起，阻塞挂起 两种状态





###  2.内存连续分配管理

- 分区大小相等：用于利用一台计算机去控制多个相同对象的场合。
- 分区大小不等：划分为含有多个较小的分区、适量的中等分区及少量的大分区。
- 动态分区分配





用户态和内核态







## 用户态和内核态

在计算机系统中，通常运行两类程序：系统内核程序和应用程序。

- 正在执行内核程序，说明此时是操作系统正在控制CPU。
- 正在执行应用程序，说明此时是应用程序正在控制CPU。





这个系统所做的，就是将操作系统

![image-20201201002355544](http://guxiangflyimagebucket.oss-cn-beijing.aliyuncs.com/img/image-20201201002355544.png)



核心态和用户态的切换，本质上就是操作系统与普通应用程序对CPU控制权的切换。

使用较高级别的特权指令 类似IO读取写入操作/ 内存删除操作  这些操作，就需要通过操作系统执行，因此普通应用程序想进行这些操作必要将。





![image-20201201002850829](http://guxiangflyimagebucket.oss-cn-beijing.aliyuncs.com/img/image-20201201002850829.png)

系统

![image-20211015135404201](http://guxiangflyimagebucket.oss-cn-beijing.aliyuncs.com/img/image-20211015135404201.png)

用户态切换，本质是应用程序和操作系统对CPU控制权的一个交接/切换





#### 什么情况下回进行用户态转到内核态

什么情况下会进行系统切换：

- 用户态程序调用操作系统的服务
- 发生了一次中断，比如说IO读取完成了，会向CPU发出一个中断信号，由于中断处理需要操作系统完成，这时候也会发生程序从用户态切换
- 程序内发生异常



#### 程序的启动

假设我们现在有一个QQ.exe 需要执行，  QQ.exe 会被加载进入内存

假设QQ.exe 在内存中的起始位置是 0X0003 ~0X20000    

0X0003是main方法， CPU通过控制总线，假设读取到一个add指令

> 一个程序的执行，首先吧可执行文件读取到内存中，找到起始的（main）地址，逐步读出指令和数据，进行计算并且

什么是进程：

- 一个程序进入内存，那么我们就称之为进程。

- 由于同一个进程内，有多个任务并发执行的需求（比如一边计算，一边接收网络数据，一边刷新界面）

  能不能多进程解决这个问题？ 可以，但是毛病多，最严重的毛病是，我们可以很轻易的破坏别的进程。

- 进程和线程的区别：

  - 进程：进程其实是一个静态的概念；程序进入内存，分配对应的资源，内存空间，进程进入内存就会产生一个主线程。
    - 进程是资源分配的基本单位
    - 进程之间资源是独立的（否则可能出现）
  - 线程：是可执行的计算单元
    - 线程是执行/调度的基本单位



#### 线程的切换

线程切换需要先保存上下文到cache中。

什么是线程撕裂者： 四核八线程 ， 三核六线程 什么意思?

- 意思是一个CPU核心里面，有一个**ALU（ 算术逻辑单元 (Arithmetic Logic Unit, *ALU*)）**，有两个 register 和  program counter （程序计数器）  这样线程的上下文切换就不需要额外缓存到cache中去了。 能极大减小线程上下文切换的消耗。

![image-20211017011600157](http://guxiangflyimagebucket.oss-cn-beijing.aliyuncs.com/img/image-20211017011600157.png)







#### 进程隔离

单进程只能使用我自己的虚拟空间









操作系统



### 进程与线程与协程



- 进程：进程其实是一个静态的概念；程序进入内存，分配对应的资源，内存空间，进程进入内存就会产生一个主线程。

  - 进程是资源分配的基本单位

  - 进程之间资源是独立的（否则可能出现）

- 线程：是可执行的计算单元

  - 线程是执行/调度的基本单位
  - 线程的创建会 在用户态和内核态中创建一个1:1 的
- 协程：我们为了提升操作系统切换的能力， 



![image-20211026123805231](http://guxiangflyimagebucket.oss-cn-beijing.aliyuncs.com/img/image-20211026123805231.png)





![image-20211026123947290](http://guxiangflyimagebucket.oss-cn-beijing.aliyuncs.com/img/image-20211026123947290.png)





![image-20211026124051183](http://guxiangflyimagebucket.oss-cn-beijing.aliyuncs.com/img/image-20211026124051183.png)





## select   pull  epull 的区别

- 







## 尚硅谷[操作系统调度]

![image-20230203175625700](http://guxiangflyimagebucket.oss-cn-beijing.aliyuncs.com/img/image-20230203175625700.png)















# 操作系统的基本特征

![image-20230313172839805](http://guxiangflyimagebucket.oss-cn-beijing.aliyuncs.com/img/image-20230313172839805.png)

## OS的并发性（Concurrence）

OS的并发性（Concurrence）

- 概念：同一时间间隔内执行和调度多个程序的能力
- 特点：
  - 宏观上，处理机同时执行多道程序
  - 微观上，处理机在多道程序间高速切换（分时交替执行）
  - 关注单个处理机同一时间段内处理任务数量的能力



相似概念：并行

- 并发：同一时间间隔（时间段）发生的事件数量午餐时段，学校餐厅并发用餐人数为12人
- 并行：同一时刻（时间点）发生的事件数量同一时间点，学校餐厅最多并行3人打餐







## OS的共享性（Sharing）

并发是共享的前提：

OS的共享性（Sharing）即资源共享，系统中的资源供多个『并发执行』的应用程序共同使用

- 同时访问方式：同一时段允许多个程序同时访问共享资源
  - 类似一个演唱会上，我也能听，你也能听
- 互斥共享方式：也叫独占式，允许多个程序在同一个共享资源上独立而互不干扰的工作
  - 共享打印机[互斥访问]、音频设备、视频设备
  - 上厕所是一个坑



并发和共享互为存在条件

- 共享性要求OS中同时运行着多道程序
  - 若只有单道程序正在运行，则不存在共享的可能
- 并发性难以避免的导致多道程序同时访问同一个资源
  - 若多道程序无法共享部分资源（比如磁盘），则无法并发

![image-20230313173824688](http://guxiangflyimagebucket.oss-cn-beijing.aliyuncs.com/img/image-20230313173824688.png)





## OS的虚拟技术（Virtual）

![image-20230313174012114](http://guxiangflyimagebucket.oss-cn-beijing.aliyuncs.com/img/image-20230313174012114.png)

- 虚拟化技术的java服务端运行实例
  - dubbo里面的负载均衡，有个  一致性hash。`ConsistentHashLoadBalance`







## 微内核操作系统结构

## 

![image-20230313190951455](http://guxiangflyimagebucket.oss-cn-beijing.aliyuncs.com/img/image-20230313190951455.png)

微内核不是一个完整的操作系统，里面只有一些最核心的功能呢。

大致可以分为两大类： 支撑功能 与 资源管理功能 两大功能。

> 例如： 进程管理、线程管理、低级存储器管理、中断处理

这些基本核心功能的运行环境，我们称之为内核态。



### 机制与策略分离的原理

- 机制：实现某一功能的具体执行机构。
- 策略：在机制的基础上借助某些参数和算法来实现该功能的优化。

机制出于底层，属于内核态













![image-20230313201114366](http://guxiangflyimagebucket.oss-cn-beijing.aliyuncs.com/img/image-20230313201114366.png)

#### 操作系统的运行机制是怎样的？



目录

> - 时钟管理
> - 中断机制
> - 原语
> - 系统数据结构
> - 系统调用







操作系统的运行机制

- **时钟管理**
  
  - 计时：提供系统时间
  - 时钟中断：比如进程切换
  
- **中断机制**

  - 提高多道程序环境下CPU利用率

  - 外中断：中断信号来源于->外部设备 （按了一个键盘）

  - 内中断：中断信号来源于->CPU内部 （程序中设置的，比如抛出了一个异常）

    内中断的三种情况

    - 陷阱/陷入（Trap）：由应用程序主动引发，用于访问内核态的操作指令

    - 故障（fault）：由错误条件引发

      

      ![image-20230313204632011](http://guxiangflyimagebucket.oss-cn-beijing.aliyuncs.com/img/image-20230313204632011.png)

      > 假设一个游戏特别大，几十个G，首先系统加载了一些核心程序进入内存，指令3执行到了没有加载进入内存的程序，就会触发一个**内存缺页中断**，去加载指令4， 然后继续执行 指令 5,6,7

      

    - 终止（abort）：由致命错误引发

      - 类似outofmemery  导致程序直接挂了。
      
      
      
      操作系统运行机制
      
      ![image-20230313211126760](http://guxiangflyimagebucket.oss-cn-beijing.aliyuncs.com/img/image-20230313211126760.png)
      
      0. 首先，产生了一个中断
      
      1. 关中断：  关中断后，其他的高级中断不再执行， 1,2,3,4,5 步骤执行完成后，再开中断
      
      2. 保存程序计数器的断点
      
      3. 引出中断服务程序
      
      4. 保存现场和屏蔽字：
      
      5. 开中断
      
      6. 执行中断服务程序：每个中断都有一个服务程序
      
         

- **原语**

  - 由若干条指令组成
  - 用来完成某个特定功能
  - **执行过程不会被中断**
  - ![image-20230313211753500](http://guxiangflyimagebucket.oss-cn-beijing.aliyuncs.com/img/image-20230313211753500.png)

  原语的特性

  - 原语运行在内核态空间
  - 原语具有原子性
  - 原语是一个程序段

- 系统数据结构

- 系统调用









